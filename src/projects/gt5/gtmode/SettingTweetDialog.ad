module ROOT
{
    attribute popup;
    attribute closed = false;

    method open(context)
    {
        self.closed = false;

        self.popup = main::SequenceUtil::ModalPage(context, ROOT);
        self.popup.open();

        return true;
    }

    method close(context)
    {
        if (self.closed)
            return;

        self.closed = true;
        ContextMain.event_mask = 0x05;
        ContextMain.disableInput();

        FadeActor.on_effect_end = function (context)
        {
            if (ROOT.popup != nil)
            {
                ROOT.popup.close();
                ROOT.popup = nil;
            }

            ContextMain.enableInput();
        }

        FadeActor.out = true;
    }

    method onInitialize(context)
    {
        var format = context.translate(ROOT, "MyHome", "WITHIN_N_LETTERS");
        Popup::Pane::Body::Start::TextFace.text = "%s %s".format(context.translate(ROOT, "MyHome", "CASE_START"), format.build(24));
        Popup::Pane::Body::Crush::TextFace.text = "%s %s".format(context.translate(ROOT, "MyHome", "CASE_CRUSH"), format.build(24));
        Popup::Pane::Body::OverTake::TextFace.text = "%s %s".format(context.translate(ROOT, "MyHome", "CASE_OVERTAKE"), format.build(24));
        Popup::Pane::Body::Win::TextFace.text = "%s %s".format(context.translate(ROOT, "MyHome", "CASE_WIN"), format.build(24));
        Popup::Pane::Body::Lose::TextFace.text = "%s %s".format(context.translate(ROOT, "MyHome", "CASE_LOSE"), format.build(24));

        ROOT.setFocus(Popup::Pane::FootRow::CancelOK::OK);

        return EVENTRESULT_FILTER;
    }

    method onFinalize(context)
    {

    }

    method onCancel(context)
    {
        main::sound.play("cancel");
        close(context);

        return EVENTRESULT_FILTER;
    }

    module Popup::Pane
    {
        module FootRow::CancelOK
        {
            module Cancel
            {
                method onActivate(context)
                {
                    main::sound.play("ok");
                    ROOT.close(context);
                
                    return EVENTRESULT_FILTER;
                }    
            }
    
            module OK
            {
                method onActivate(context)
                {
                    main::sound.play("ok");
                    ROOT.close(context);
                
                    return EVENTRESULT_FILTER;
                }    
            }
        }    
    }
}
